# Test: Slice a 2D struct array (slice the outer dimension) and GC

@alias "rt_arena_v2_gc"
native fn gc_collect(arena): int

struct Entry =>
    key: str
    value: str

fn buildAndSlice(): Entry[][] =>
    var r1: Entry[] = { Entry { key: "a", value: "1" } }
    var r2: Entry[] = { Entry { key: "b", value: "2" } }
    var r3: Entry[] = { Entry { key: "c", value: "3" } }
    var r4: Entry[] = { Entry { key: "d", value: "4" } }
    var grid: Entry[][] = { r1, r2, r3, r4 }
    var sliced: Entry[][] = grid[1..3]
    return sliced

fn main(): void =>
    var grid: Entry[][] = buildAndSlice()
    gc_collect()

    if grid.length != 2 =>
        print($"FAIL: length {grid.length}\n")
        return
    if grid[0][0].key != "b" || grid[0][0].value != "2" =>
        print("FAIL: [0][0]\n")
        return
    if grid[1][0].key != "c" || grid[1][0].value != "3" =>
        print("FAIL: [1][0]\n")
        return
    print("PASS\n")
