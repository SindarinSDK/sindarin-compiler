import "../../sdk/core/version"

fn myVersionCmp(aMaj: int, aMin: int, aPat: int, aPre: str, bMaj: int, bMin: int, bPat: int, bPre: str): int =>
    print($"    myVersionCmp: a={aMaj}.{aMin}.{aPat}-'{aPre}' vs b={bMaj}.{bMin}.{bPat}-'{bPre}'\n")
    print($"    aPre len={aPre.length}, bPre len={bPre.length}\n")

    if aMaj < bMaj =>
        return -1
    if aMaj > bMaj =>
        return 1
    if aMin < bMin =>
        return -1
    if aMin > bMin =>
        return 1
    if aPat < bPat =>
        return -1
    if aPat > bPat =>
        return 1
    # Version with prerelease < same version without prerelease
    if aPre != "" =>
        print($"    aPre != '': checking if bPre == ''\n")
        if bPre == "" =>
            print($"    aPre != '' && bPre == '' => returning -1\n")
            return -1
    if aPre == "" =>
        print($"    aPre == '': checking if bPre != ''\n")
        if bPre != "" =>
            print($"    aPre == '' && bPre != '' => returning 1\n")
            return 1
    # Both have prerelease or both empty
    print($"    Reached end, both empty or both have prerelease => returning 0\n")
    return 0

fn main(): int =>
    print("=== Debug compare in loop ===\n\n")

    var v: Version = Version.parse("2.0.0")
    print($"v = {v.major}.{v.minor}.{v.patch}, prerelease='{v.prerelease}' (len={v.prerelease.length})\n")

    # Test outside loop
    print("\n=== Outside loop ===\n")
    print("Calling myVersionCmp:\n")
    var cmpOut: int = myVersionCmp(v.major, v.minor, v.patch, v.prerelease, 2, 0, 0, "")
    print($"Result: {cmpOut}\n")

    # Test inside loop
    print("\n=== Inside loop ===\n")
    var constraints: str = ">=1.0.0, <2.0.0"
    var parts: str[] = constraints.split(",")

    var i: int = 0
    while i < parts.length =>
        var part: str = parts[i].trim()

        if i == 1 =>
            print($"Testing comparison for part '{part}'\n")
            print($"v.prerelease = '{v.prerelease}' (len={v.prerelease.length})\n")
            print("Calling myVersionCmp:\n")
            var cmpIn: int = myVersionCmp(v.major, v.minor, v.patch, v.prerelease, 2, 0, 0, "")
            print($"Result: {cmpIn}\n")

        i = i + 1

    return 0
