// Test: after syncing all threads, array becomes writable
// Expected: Compilation should SUCCEED (type check)
// Both threads must sync before the array is fully unfrozen

fn process1(data: int[]): int =>
    return data[0]

fn process2(data: int[]): int =>
    return data[1]

fn main(): void =>
    var arr: int[] = {1, 2, 3}
    var r1: int = &process1(arr)  // arr frozen (count=1)
    var r2: int = &process2(arr)  // arr frozen (count=2)
    var v1: int = r1!             // Sync r1: arr still frozen (count=1)
    var v2: int = r2!             // Sync r2: arr now unfrozen (count=0)
    arr[0] = 99                   // OK: arr is fully unfrozen
    print($"arr[0]: {arr[0]}\n")
