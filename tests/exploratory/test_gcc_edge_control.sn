// Exploratory test: Control flow edge cases
// Tests control flow patterns that could produce problematic C code

// --- Nested if/else (within indentation limits) ---
fn test_nested_if(): void =>
    var x: int = 10
    if x > 0 =>
        if x > 2 =>
            if x > 4 =>
                if x > 6 =>
                    if x > 8 =>
                        print("Deep nesting reached level 5\n")

// --- Complex boolean expressions ---
fn test_complex_booleans(): void =>
    var a: bool = true
    var b: bool = false
    var c: bool = true
    var d: bool = false
    var e: bool = true

    var r1: bool = a && !b && c && !d && e
    var r2: bool = a || b || c || d || e
    var r3: bool = (a && b) || (c && d) || e
    var r4: bool = !(a && b) && !(c && d) && e
    var r5: bool = (a || b) && (c || d) && (e || !a)

    print($"r1={r1} r2={r2} r3={r3} r4={r4} r5={r5}\n")

    var x: int = 50
    var complex: bool = (x > 10 && x < 100) || (x == 50)
    print($"Complex comparison: {complex}\n")

// --- Nested loops with break/continue ---
fn test_nested_loops(): void =>
    var count: int = 0

    for var i: int = 0; i < 10; i++ =>
        for var j: int = 0; j < 10; j++ =>
            if j == 5 =>
                break
            if i % 2 == 0 =>
                continue
            count = count + 1

    print($"Nested loop count: {count}\n")

// --- While loop with complex condition ---
fn test_complex_while(): void =>
    var i: int = 0
    var sum: int = 0

    while i < 100 && sum < 500 =>
        sum = sum + i
        i = i + 1

    print($"While stopped at i={i} sum={sum}\n")

// --- For loop with complex expressions ---
fn test_complex_for(): void =>
    var total: int = 0

    for var i: int = 1; i * i <= 100; i++ =>
        total = total + i * i

    print($"Sum of squares: {total}\n")

// --- Early return from deep nesting ---
fn find_value(target: int): int =>
    for var i: int = 0; i < 10; i++ =>
        for var j: int = 0; j < 10; j++ =>
            if i * 10 + j == target =>
                return i * 100 + j
    return -1

fn test_early_return(): void =>
    var r1: int = find_value(35)
    var r2: int = find_value(99)
    var r3: int = find_value(0)

    print($"find(35)={r1} find(99)={r2} find(0)={r3}\n")

// --- If/else if chains ---
fn classify(x: int): str =>
    if x < 0 =>
        return "negative"
    else if x == 0 =>
        return "zero"
    else if x < 10 =>
        return "small"
    else if x < 100 =>
        return "medium"
    else if x < 1000 =>
        return "large"
    else if x < 10000 =>
        return "very large"
    else if x < 100000 =>
        return "huge"
    else =>
        return "enormous"

fn test_if_else_chain(): void =>
    var values: int[] = {-5, 0, 5, 50, 500, 5000, 50000, 500000}
    for v in values =>
        var cls: str = classify(v)
        print($"  {v} -> {cls}\n")

// --- Loop with all control flow ---
fn test_all_control(): void =>
    var found: int = -1
    var iterations: int = 0

    for var i: int = 0; i < 20; i++ =>
        iterations = iterations + 1

        if i < 5 =>
            continue

        if i == 15 =>
            break

        if i * i == 100 =>
            found = i

    print($"Iterations: {iterations} Found: {found}\n")

// --- Nested for-each ---
fn test_nested_foreach(): void =>
    var matrix: int[][] = {
        {1, 2, 3},
        {4, 5, 6},
        {7, 8, 9}
    }

    var sum: int = 0
    for row in matrix =>
        for v in row =>
            if v % 2 == 0 =>
                sum = sum + v

    print($"Sum of even in matrix: {sum}\n")
    assert(sum == 20, "2+4+6+8=20")

// --- Short-circuit evaluation ---
fn side_effect_true(): bool =>
    print("  side_effect_true called\n")
    return true

fn side_effect_false(): bool =>
    print("  side_effect_false called\n")
    return false

fn test_short_circuit(): void =>
    print("Testing && short-circuit:\n")
    if false && side_effect_true() =>
        print("  This shouldn't print\n")
    else =>
        print("  Short-circuited correctly\n")

    print("Testing || short-circuit:\n")
    if true || side_effect_false() =>
        print("  Short-circuited correctly\n")
    else =>
        print("  This shouldn't print\n")

// --- Many sequential if statements ---
fn test_many_ifs(): void =>
    var x: int = 42
    var count: int = 0

    if x > 0 =>
        count = count + 1
    if x > 5 =>
        count = count + 1
    if x > 10 =>
        count = count + 1
    if x > 15 =>
        count = count + 1
    if x > 20 =>
        count = count + 1
    if x > 25 =>
        count = count + 1
    if x > 30 =>
        count = count + 1
    if x > 35 =>
        count = count + 1
    if x > 40 =>
        count = count + 1
    if x > 45 =>
        count = count + 1

    print($"Many ifs count: {count}\n")

fn main(): void =>
    print("=== Control Flow Edge Case Tests ===\n\n")

    test_nested_if()
    test_complex_booleans()
    test_nested_loops()
    test_complex_while()
    test_complex_for()
    test_early_return()
    test_if_else_chain()
    test_all_control()
    test_nested_foreach()
    test_short_circuit()
    test_many_ifs()

    print("\n=== All Control Flow Tests Done ===\n")
