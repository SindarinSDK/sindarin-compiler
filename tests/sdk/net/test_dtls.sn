# ==============================================================================
# test_dtls.sn - Tests for SDK DTLS Connection
# ==============================================================================
# Tests the DtlsConnection struct and its methods.
#
# TODO: Implement a DtlsListener (server) so these tests can be self-contained.
#       Currently the DTLS SDK only provides a client (DtlsConnection.connect),
#       so all tests require an external DTLS echo server which isn't available
#       in CI. Once a DtlsListener is added (similar to QuicListener), uncomment
#       the tests below and make them self-contained with a local server.
#
# To run manually with an external server:
#   openssl s_server -dtls -accept 4433 -cert server.crt -key server.key -nocert
#   SN_CERTS=server.crt bin/sn tests/sdk/net/test_dtls.sn -o /tmp/test_dtls && /tmp/test_dtls
# ==============================================================================

import "../../../sdk/net/dtls"

# fn test_dtls_connect(): void =>
#     print("test_dtls_connect: ")
#     var conn: DtlsConnection = DtlsConnection.connect("127.0.0.1:4433")
#     var addr: str = conn.remoteAddress()
#     assert(addr == "127.0.0.1:4433", "Remote address should match")
#     conn.close()
#     print("PASS\n")

# fn test_dtls_send_receive(): void =>
#     print("test_dtls_send_receive: ")
#     var conn: DtlsConnection = DtlsConnection.connect("127.0.0.1:4433")
#     var msg: byte[] = "Hello DTLS".toBytes()
#     var sent: int = conn.send(msg)
#     assert(sent == 10, "Should send 10 bytes")
#     var response: byte[] = conn.receive(1024)
#     assert(response.length > 0, "Should receive response")
#     assert(response.toString() == "Hello DTLS", "Should echo back message")
#     conn.close()
#     print("PASS\n")

# fn test_dtls_close(): void =>
#     print("test_dtls_close: ")
#     var conn: DtlsConnection = DtlsConnection.connect("127.0.0.1:4433")
#     conn.close()
#     conn.close()
#     print("PASS\n")

fn main(): void =>
    print("=== SDK DTLS Tests ===\n\n")

    # TODO: Uncomment once DtlsListener is implemented
    # test_dtls_connect()
    # test_dtls_send_receive()
    # test_dtls_close()

    print("All DTLS tests passed!\n")
