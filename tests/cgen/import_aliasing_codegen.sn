// Test SDK compression module

import "sdk/encoding/zlib" as zlibA
import "./imports/import_aliasing_codegen_B" as moduleB
import "./imports/import_aliasing_codegen_C" as moduleC
import "./imports/import_aliasing_codegen_C" as moduleC_1

static var lockVal:sync int = 1

fn test_basic_compress_decompress_A(): void =>
    print("test_basic_compress_decompress: ")

    // Original data - "Hello, World!"
    var original: byte[] = {72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33}

    // Compress
    var compressed: byte[] = zlibA.compressData(original)
    assert(compressed.length > 0, "Compression should produce output")

    // Decompress
    var decompressed: byte[] = moduleB.zlibB.decompressData(compressed, original.length)
    assert(decompressed.length == original.length, "Decompressed size should match original")

    // Verify content matches
    var i: int = 0
    while i < original.length =>
        assert(decompressed[i] == original[i], "Decompressed content should match original")
        i = i + 1

    print("PASS\n")

fn main(): void =>
    print("=== SDK Compression Tests ===\n\n")

    test_basic_compress_decompress_A()
    moduleB.test_basic_compress_decompress_B()
    moduleC.test_basic_compress_decompress_C()

    assert(moduleB.randomValue != moduleC.randomValue, "Should be different because different modules")
    assert(moduleC.randomValue != moduleC_1.randomValue, "Should be different because different aliased modules should have different state")
    // Static variables are SHARED across all aliases of the same module (canonical module identity)
    // Non-static variables are SEPARATE per alias (each alias has its own instance)
    assert(moduleC.randomUuid.toString() == moduleC_1.randomUuid.toString(), "Should be same because static vars are shared across aliases")

    print("\nAll compression tests passed!\n")

    lock(lockVal) => 
        lockVal = 3
