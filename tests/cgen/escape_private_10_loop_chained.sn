// Code Generation Test: 10 Nested Loop Arena Escape (Private, Chained)
//
// Tests that primitive values escape correctly from private functions
// through 10 nested loops. Only primitives can escape private blocks.

private fn compute_chained(): int =>
    var result: int = 0
    for var a: int = 1; a <= 1; a++ =>
        var s1: int = 0
        for var b: int = 1; b <= 1; b++ =>
            var s2: int = 0
            for var c: int = 1; c <= 1; c++ =>
                var s3: int = 0
                for var d: int = 1; d <= 1; d++ =>
                    var s4: int = 0
                    for var e: int = 1; e <= 1; e++ =>
                        var s5: int = 0
                        for var f: int = 1; f <= 1; f++ =>
                            var s6: int = 0
                            for var g: int = 1; g <= 1; g++ =>
                                var s7: int = 0
                                for var h: int = 1; h <= 1; h++ =>
                                    var s8: int = 0
                                    for var i: int = 1; i <= 1; i++ =>
                                        var s9: int = 0
                                        for var j: int = 1; j <= 1; j++ =>
                                            var inner: int = 11
                                            s9 = s9 + inner + 10
                                        s8 = s8 + s9 + 9
                                    s7 = s7 + s8 + 8
                                s6 = s6 + s7 + 7
                            s5 = s5 + s6 + 6
                        s4 = s4 + s5 + 5
                    s3 = s3 + s4 + 4
                s2 = s2 + s3 + 3
            s1 = s1 + s2 + 2
        result = result + s1 + 1
    return result

fn main(): int =>
    println("Private chained test (10 loops):")
    println("Primitives escape one level at a time")
    var computed: int = compute_chained()
    // 11 + 10 = 21, +9 = 30, +8 = 38, +7 = 45, +6 = 51, +5 = 56, +4 = 60, +3 = 63, +2 = 65, +1 = 66
    println($"Computed checksum: {computed}")
    if computed == 66 =>
        println("PASS: Checksum correct - primitives escaped through all 10 levels")
    else =>
        println("FAIL: Checksum incorrect")
    return 0
