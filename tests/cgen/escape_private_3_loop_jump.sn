// Code Generation Test: 3 Nested Loop Arena Escape (Private, Jump)
//
// Tests that primitives can jump directly from innermost loop to any
// outer scope in private functions. Only primitives can escape.

private fn compute_with_jumps(): int =>
    var to_d1: int = 0
    for var i: int = 1; i <= 2; i++ =>
        var to_d2: int = 0
        for var j: int = 1; j <= 2; j++ =>
            var to_d3: int = 0
            for var k: int = 1; k <= 2; k++ =>
                // All jumps originate from depth 4
                var value: int = i * 100 + j * 10 + k
                to_d3 = to_d3 + value
                to_d2 = to_d2 + value * 2
                to_d1 = to_d1 + value * 3
            to_d2 = to_d2 + to_d3
        to_d1 = to_d1 + to_d2
    return to_d1

fn main(): int =>
    println("Private jump test (3 loops):")
    println("Primitives jump directly to outer scopes")
    var computed: int = compute_with_jumps()
    // d3 contributions: (111+112)*1 + (121+122)*1 + (211+212)*1 + (221+222)*1 = 223+243+423+443 = 1332
    // d2 contributions: (111+112)*2 + 223 + (121+122)*2 + 243 + ... = 446+223 + 486+243 + 846+423 + 886+443 = 3996
    // d1 contributions: (111+112+121+122+211+212+221+222)*3 + 3996 = 1332*3 + 3996 = 3996 + 3996 = 7992
    println($"Computed checksum: {computed}")
    if computed == 7992 =>
        println("PASS: Checksum correct - primitives escaped properly")
    else =>
        println("FAIL: Checksum incorrect")
    return 0
