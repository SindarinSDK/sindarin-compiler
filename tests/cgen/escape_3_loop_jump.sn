// Code Generation Test: 3 Nested Loop Arena Escape (Jump)
//
// Tests that string values can jump directly from innermost loop (depth 4)
// to any outer scope, skipping intermediate arenas.

fn build_with_jumps(): str =>
    var to_d1: str = ""
    for var i: int = 1; i <= 2; i++ =>
        var to_d2: str = ""
        for var j: int = 1; j <= 2; j++ =>
            var to_d3: str = ""
            for var k: int = 1; k <= 2; k++ =>
                // All jumps originate from depth 4
                var tag: str = $"[i={i},j={j},k={k}]"
                to_d3 = to_d3 + "d4->d3" + tag + " "
                to_d2 = to_d2 + "d4->d2" + tag + " "
                to_d1 = to_d1 + "d4->d1" + tag + " "
            to_d2 = to_d2 + "| collected_d3:(" + to_d3 + ") "
        to_d1 = to_d1 + "| collected_d2:(" + to_d2 + ")\n"
    return to_d1

fn main(): int =>
    println("Jump escape test (3 loops):")
    println("Values jump directly from d4 to d3, d2, and d1")
    println(build_with_jumps())
    println("PASS: All jump escapes succeeded")
    return 0
