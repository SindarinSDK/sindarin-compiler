// Code Generation Test: 10 Nested Loop Arena Escape (Private, Jump)
//
// Tests that primitives can jump directly from innermost loop to any
// outer scope in private functions through 10 nested loops.

private fn compute_with_jumps(): int =>
    var to_d1: int = 0
    for var a: int = 1; a <= 1; a++ =>
        var to_d2: int = 0
        for var b: int = 1; b <= 1; b++ =>
            var to_d3: int = 0
            for var c: int = 1; c <= 1; c++ =>
                var to_d4: int = 0
                for var d: int = 1; d <= 1; d++ =>
                    var to_d5: int = 0
                    for var e: int = 1; e <= 1; e++ =>
                        var to_d6: int = 0
                        for var f: int = 1; f <= 1; f++ =>
                            var to_d7: int = 0
                            for var g: int = 1; g <= 1; g++ =>
                                var to_d8: int = 0
                                for var h: int = 1; h <= 1; h++ =>
                                    var to_d9: int = 0
                                    for var i: int = 1; i <= 1; i++ =>
                                        var to_d10: int = 0
                                        for var j: int = 1; j <= 1; j++ =>
                                            // All jumps from depth 11
                                            to_d10 = 10
                                            to_d9 = 9
                                            to_d8 = 8
                                            to_d7 = 7
                                            to_d6 = 6
                                            to_d5 = 5
                                            to_d4 = 4
                                            to_d3 = 3
                                            to_d2 = 2
                                            to_d1 = 1
                                        to_d9 = to_d9 + to_d10
                                    to_d8 = to_d8 + to_d9
                                to_d7 = to_d7 + to_d8
                            to_d6 = to_d6 + to_d7
                        to_d5 = to_d5 + to_d6
                    to_d4 = to_d4 + to_d5
                to_d3 = to_d3 + to_d4
            to_d2 = to_d2 + to_d3
        to_d1 = to_d1 + to_d2
    return to_d1

fn main(): int =>
    println("Private jump test (10 loops):")
    println("Primitives jump directly to each target depth")
    var computed: int = compute_with_jumps()
    // After jumps: d10=10, d9=9+10=19, d8=8+19=27, d7=7+27=34, d6=6+34=40
    // d5=5+40=45, d4=4+45=49, d3=3+49=52, d2=2+52=54, d1=1+54=55
    println($"Computed checksum: {computed}")
    if computed == 55 =>
        println("PASS: Checksum correct - primitives escaped properly")
    else =>
        println("FAIL: Checksum incorrect")
    return 0
